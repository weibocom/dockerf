clusterby: swarm
masternode: icy-master
discovery: consul://consulcluster-1:8500/dockerftest
driver: aliyun
driveroptions:
   - --engine-install-url
   - https://get.daocloud.io/docker
   - --engine-insecure-registry
   - 123.57.25.116:5000
   - --swarm-image
   - 123.57.25.116:5000/icycrystal4/swarm
   - --aliyun-access-key-id
   - i7Uq54EGpOtEjJO9
   - --aliyun-access-key-secret 
   - 6FvdjWOyae4XQyeXqBZM29vHDhPlLG 
globaloptions:
   - --native-ssh

machine:
    os: ubuntu-14.04-64
    master:
       minnum: 1
       maxnum: 1
       cpu: 2
       memory: 2g
       disk:
          type: ssd
          capacity: 20g
       region: cn-beijing
       init: touch ~/hello
       driveropts:
       consul: false

    topology:
       consulcluster:
          minnum: 1
          maxnum: 1
          cpu: 1
          memory: 1g
          disk:
             type: ssd
             capacity: 20g
          region: cn-beijing
          init: touch ~/hello
          driveropts:
          consul: false

       # frontend:
       #    minnum: 1
       #    maxnum: 1
       #    cpu: 1
       #    memory: 1g
       #    disk:
       #       type: ssd
       #       capacity: 10240m
       #    region: cn-beijing
       #    init: touch ~/hello
       #    driveropts:
       #    consul: false
       nginx:
          minnum: 1
          maxnum: 1
          cpu: 1
          memory: 512m
          disk:
             type: ssd
             capacity: 20g
          region: cn-beijing
          init: touch ~/hello
          driveropts:
          consul: true

container:
   topology:
       webnginx:
         port: 8408:8408
         num: 1
         image: 123.57.25.116:5000/icycrystal4/wb-nginx:0.6
         restart: false
         url: if.nginx
         machine: nginx
         volums:
            - /var:/var

       # web:
       #   port: 40000~50000:8080
       #   num: 1
       #   image: 123.57.25.116:5000/icycrystal4/tomcat:latest
       #   prestop: touch ~/503  # execute some shell commands on the machine, not in container, before stop the service 
       #   poststart: touch ~/200
       #   restart: true
       #   servicediscover: webnginx
       #   machine: frontend

servicediscover:
  # webnginx:
  #   driver: nginx
  #   upstream: discover
  #   container: webnginx

consulcluster:
   server:
      service: weibo
      image: 123.57.25.116:5000/icycrystal4/progrium-consul:latest
      domain: weibo
      ips: 
         # - 192.168.99.101
      nodes:
         - consulcluster-1
         # - consulcluster-2
         # - consulcluster-3
      machine: consulcluster
   agent:
      image: 123.57.25.116:5000/icycrystal4/progrium-consul:latest
   registrator:
      image: 123.57.25.116:5000/icycrystal4/progrium-registrator

