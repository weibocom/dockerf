clusterby: swarm
masternode: master-node
discovery: consul://192.168.99.110:8500/testicy
driver: virtualbox
driveroptions:
   - --engine-insecure-registry
   - 192.168.99.100:5000
   - --swarm-image
   - 192.168.99.100:5000/icycrystal4/swarm:0711

machine:
    minnum: 2
    maxnum: 2
    os: 
       provider: ubuntu 
       bits: 64
       version: 14.04
    init: touch ~/hello
    cpu: 3
    disk: 
       ssd: 200g
    memory: 512m
    regions:
      BJ: 100   # percentage that num of machine at this regions
      TJ: 0

containers:
    - name: webnginx
      port: 8408:8408
      num: 1
      image: 192.168.99.100:5000/icycrystal4/wb-nginx:0.6
      restart: false
      url: nginx.testservice

    - name: web
      port: 40000~50000:8080
      num: 1
      image: 192.168.99.100:5000/icycrystal4/tomcat:latest
      prestop: touch ~/503  # execute some shell commands on the machine, not in container, before stop the service 
      poststart: touch ~/200
      restart: false
      servicediscover: webnginx

servicediscovers:
  webnginx:
    driver: nginx
    upstream: discover
    container: webnginx

consulcluster:
   server:
      service: weibo
      image: 192.168.99.100:5000/icycrystal4/progrium-consul:latest
      domain: weibo
      ips: 
         - 192.168.99.110
      nodes:
         # - consulserver-boot
         # - consulcluster-2
         # - consulcluster-3
      create: false
   agent:
      image: 192.168.99.100:5000/icycrystal4/progrium-consul:latest
   registrator:
      image: 192.168.99.100:5000/icycrystal4/progrium-registrator

