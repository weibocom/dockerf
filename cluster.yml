clusterby: swarm
masternode: master-node
discovery: consul://192.168.99.101:8500/testicy0721
driver: virtualbox
driveroptions:
   - --engine-insecure-registry
   - 192.168.99.100:5000
   - --swarm-image
   - 192.168.99.100:5000/icycrystal4/swarm

machine:
    os: 
       provider: ubuntu 
       bits: 64
       version: 14.04
    topology:
       frontend:
          minnum: 1
          maxnum: 1
          cpu: 1
          memory: 1g
          disk:
             type: ssd
             capacity: 10240m
          region: bj-dc1
          init: touch ~/hello
          driveropts:
          consul: false
       nginx:
          minnum: 1
          maxnum: 1
          cpu: 1
          memory: 512m
          disk:
             type: ssd
             capacity: 20g
          region: bj-dc1
          init: touch ~/hello
          driveropts:
          consul: true

container:
   topology:
       webnginx:
         port: 8408:8408
         num: 1
         image: 192.168.99.100:5000/icycrystal4/wb-nginx:0.6
         restart: false
         url: if.nginx
         machine: nginx
         volums:
            - /var:/var

       web:
         port: 40000~50000:8080
         num: 2
         image: 192.168.99.100:5000/icycrystal4/tomcat:latest
         prestop: touch ~/503  # execute some shell commands on the machine, not in container, before stop the service 
         poststart: touch ~/200
         restart: true
         servicediscover: webnginx
         machine: frontend

servicediscover:
  webnginx:
    driver: nginx
    upstream: discover
    container: webnginx

consulcluster:
   server:
      service: weibo
      image: 192.168.99.100:5000/icycrystal4/progrium-consul:latest
      domain: weibo
      ips: 
         - 192.168.99.101
      nodes:
         # - consulserver-boot
         # - consulcluster-2
         # - consulcluster-3
      create: false
   agent:
      image: 192.168.99.100:5000/icycrystal4/progrium-consul:latest
   registrator:
      image: 192.168.99.100:5000/icycrystal4/progrium-registrator

